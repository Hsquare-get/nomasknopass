# TIL1128

작업할 데이터셋 : https://github.com/cabani/MaskedFace-Net

데이터 타입 : Image 1024 x 1024 jpg (모두 동일)

데이터 크기 : 총 38GB (133,000여장) [19GB (With Mask 67000장) + 19GB (Without Mask 67000장)]

클래스 : 마스크 착용(합성이미지) 10000장 + 마스크 불량착용(합성이미지) 10000장



## AWS PySpark 이미지 분산처리

이미지 데이터 불러와서 작업 : https://databricks.com/blog/2018/12/10/introducing-built-in-image-data-source-in-apache-spark-2-4.html



---

#### 현재 상황

빅데이터반에서는 캐글에서 받은 데이터셋이 마스크 착용/미착용 분류가 제대로 되지 않은 것들이 있었어서

AI반이 최소한의 모델 학습을 시작 할 수 있도록 수작업으로 이미지 데이터 2000장정도 분류해서 전달한 상황입니다.



raw데이터의 크기는 총 13만여장(38GB)인데 분산처리를 하여 빠르게 처리할 수 있는 스파크를 활용해서 원하는 이미지 영역을 크로핑하거나 연산속도를 높여주기 위해 흑백처리하는 등 Augmentation 전처리를 해볼 예정



--> AI반과 이미지 작업이 겹치거나 그마저도 빅데이터반에서는 배우지 않았던 이미지 전처리를 하다가 진행이 더뎌서 우리반이 배웠고 그래도 해볼 수 있는 것들을 생각하여 선택과 집중을 한다면 이미지처리에 부담을 덜고 AI반에게 이미지나 다른 데이터 요청을 받으면 수행해주고 빅데이터반은 코로나 관련 통계파트를 시각화 해주는 것

네이버 뉴스검색 : 지하철 마스크 --> 날짜, 기사제목, 본문 내용 크롤링 후 워드클라우드 시각화, 날짜별로 특정단어들이 많이 나타나거나 추이를 시각화해주기



#### 어려운점

**빅데이터반**

캐글에서 이미 분류된 데이터를 확보했는데 코스크나 턱스크도 안쓴분류로 재분류하는 작업을 얼굴인식을하는 것으로는 자동화하기 힘들었습니다 --> 모델 시험용으로 급하게 수작업으로 1000장씩 분류를 해보기는 했는데 다른 방법이 있었을까요?



**AI반** 

모델1 (2.9GB)

- 코스크,턱스크 어느정도 구별해낸다

- 문제점 :  검은색, 초록색, 모양이 특이한 마스크는 판단을 잘 못한다. 

모델2

- 흑백처리(channel 1) : 초록색 마스크는 구별을 하는데 검은색 마스크에서 코스크,턱스크를 마스크 썼다고 잘못 판단, 흰색마스크는 안썼다고 판단

모델3

- 흑백처리(channel3) : 오늘(11/28) 모델학습 예정



### 현직자 멘토링

비지도학습을 코스크 턱스크 **클러스터링 기법**을 적용해서 비지도학습을 수행해보는 방향 --> 한쪽으로 클러스터링이 될테니까 y값으로 일괄처리하는 방법 (한쪽에서는 코스크이미지가 보일것이고 다른쪽에서는 그렇지 않은 이미지가 보일 것)



마스크 자체를 인식하는것보다 코나 턱이 인식되면 --> 코나 입을 찾기위해 좌표가 아니라 색상이나 음양으로 인식

Haar Casscades (얼굴안에서 좌표데이터가 아니라 음양으로 코나 눈을 찾을 수 있다)



스파크를 활용하여 빅데이터를 처리하는 것은 방향은 좋다. 보통 실시간처리를 할 때 스파크를 활용한다. 

데이터를 정규화해야합니다. 데이터를 분류하거나 인식을 할 때 데이터가 제대로 들어가게된다. 이미지 전처리하는 과정은 반드시 필요하다. (Normalizatoin, Softmax)



증식처리를 하게되면 (수집된 데이터가 많지 않을때) 잡음을 일부러 집어넣어서 여러가지 다양하게 학습하게 하는 방법이다. 드롭함수를 써서 다음번 넘어갈때 오버피팅을 줄여줄 수도 있다.



### 빅데이터 멘토링

#### 프로젝트 이슈

저희가 작업을 진행하면서 어려웠던 점은

마스크를 쓴 이미지를 준비하는데 있어서 인스타나 구글에서 웹크롤링하는 방법은 불순물이 너무 많이 섞여나와서 크롤링 보다는 캐글에서 제공하는 데이터셋을 가져오려고 했습니다. 그런데 캐글에서 가져와보니 이미 마스크 쓴거 안쓴거 이미지들이 어느정도 분류돼 있었고 이미지 처리에 대해 많이 배우지 못한상태에서 AI팀과 나뉘어서  하다보니 작업이 겹치기도하고 업무 분리와 명확한 역할에서 갈피를 잡기 어려운 상황이었습니다. 



**최종원 멘토님** : 프로젝트 마무리하는 시각에서보면 데이터 마스크 착용에 대한 전처리쪽을 맡기거나 일부 배워서 가고, 크롤링 기술을 익혀서 이 프로젝트를 마무리하는 것이 더 남을 수 있다. 크롤링 자체는 본인들 만의 기술로 가지고 갔으면 좋겠다.



**박인근 멘토님**: 캐글에서 수집해온 데이터들은 마스크 쓴이미지/안쓴이미지로 나뉘어져있는데 턱스크 이미지나 코스크 이미지들을 수집해보는 것도 좋을 것이다.



**서봉국 멘토님** : 두 클래스는 나눠져 있지만 나눠서 생각하지 않아야한다. 너무 구분해서 접근하지 말고 조금 더 포괄적으로 AI반과 빅데이터반이 한팀처럼 움직였으면 좋겠다. 파생적인 예측 모델, 다른 서비스를 제공할 수 있는 아이디어를 고민해봐야한다. 예를 들어서, 특정 수어같은 것을 분석 서비스 (AI : 수어 분석 해석을 하고, 빅데이터 : 수어를 통해서 실행된 서비스들을 축적해서 수어를 제시하는 고객들에게 맞춤형 추천서비스)

전처리에서 끝나지 말고 좀 더 데이터를 핸들링해보는 것을 권장한다. 



**윤석용 멘토님** : 프로젝트에서는 빅데이터와 AI가 같이 움직여야 합니다. 한 울타리 안에서 움직이게끔 모여서 얘기해봐야한다. 클래스를 늘리는 부분에 대해서는 쉽지 않을 것이다. 클래스를 늘리는 것보다는 지금 있는 클래스를 가지고 어떤 파생 서비스를 생산해낼 수 있느냐를 고민해야할 것

클래스 언밸런싱 문제가 나타나므로 코스크 턱스크를 분류하는 것은 짧은 프로젝트안에서 시간과 돈 등 자원이 한정적이다.

지금 있는거가지고 어떻게 서비스를 잘 할것이냐, 어떤 파생 서비스(맞춤형 서비스)를 제공할건지 고민해야한다.

